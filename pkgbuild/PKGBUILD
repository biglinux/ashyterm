#Maintainer: Leonardo Berbert <leo4berbert@gmail.com>
#Maintainer: Tales A. Mendonça <talesam@gmail.com>
#Maintainer: Bruno Gonçalves <www.biglinux.com.br>

pkgname=ashyterm
pkgdesc="A modern GTK4/Adwaita terminal emulator with advanced session management, SSH integration, File Manager, and security features."

depends=(
    'gtk4'
    'libadwaita'
    'libsecret'
    'python'
    'python-py7zr'
    'python-gobject'
    'python-setproctitle'
    'python-requests'
    'sshpass'
    'rsync'
    'vte4'
    'libchildenv' # Optional, but recommended to improve GTK memory management.
    'mimalloc' # Optional, but recommended to improve GTK memory management.
)
makedepends=(
    'python-build'
    'python-installer'
    'python-uv-build'
    'python-wheel'
)
#optdepends=('')

conflicts=('comm-ashyterm')
provides=('comm-ashyterm')
replaces=('comm-ashyterm')

pkgver=$(date +%y.%m.%d)
pkgrel=$(date +%H%M)

arch=('any')
license=('MIT')
url="https://github.com/big-comm/${pkgname}"
_gitbranch="main"
source=("git+${url}.git#branch=${_gitbranch}")
md5sums=('SKIP')

build() {
    cd "${srcdir}/${pkgname}"
    python -m build --wheel --no-isolation --skip-dependency-check
}

package() {
    cd "${srcdir}/${pkgname}"

    python -m installer --destdir="$pkgdir" dist/*.whl

    # Install files
    cp -a usr/share "${pkgdir}/usr/share"

    # Install license file if present
    if [ -f "LICENSE" ]; then
        install -Dm644 LICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
    fi

    # Install documentation if present
    if [ -f "README.md" ]; then
        install -Dm644 README.md "${pkgdir}/usr/share/doc/${pkgname}/README.md"
    fi
}
